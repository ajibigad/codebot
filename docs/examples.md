# Examples

Practical examples and recipes for using Codebot.

## CLI Examples

### Simple Bug Fix

**task.yaml:**
```yaml
repository_url: https://github.com/user/myproject.git
description: Fix the null pointer exception in UserService.java
```

**Run:**
```bash
codebot run --task-prompt-file task.yaml
```

### Feature with Ticket ID

**task.yaml:**
```yaml
repository_url: https://github.com/user/myproject.git
ticket_id: FEA-456
ticket_summary: add-dark-mode
description: |
  Add dark mode support to the application.
  Include a toggle in the settings page.
  Ensure all existing tests still pass.
```

**Run:**
```bash
codebot run --task-prompt-file task.yaml
```

### Custom Base Branch

**task.yaml:**
```yaml
repository_url: https://github.com/user/myproject.git
base_branch: develop
description: Backport security fix to develop branch
```

**Run:**
```bash
codebot run --task-prompt-file task.yaml
```

### Inline JSON Task

```bash
codebot run --task-prompt '{
  "repository_url": "https://github.com/user/repo.git",
  "description": "Add README with installation instructions"
}'
```

## HTTP API Examples

### Submit Task (curl)

```bash
curl -X POST http://localhost:5000/api/tasks/submit \
  -H "Authorization: Bearer your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "repository_url": "https://github.com/user/repo.git",
    "description": "Add dark mode support",
    "ticket_id": "FEAT-123"
  }'
```

**Response:**
```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "pending",
  "message": "Task queued successfully"
}
```

### Check Task Status

```bash
curl http://localhost:5000/api/tasks/550e8400-e29b-41d4-a716-446655440000/status \
  -H "Authorization: Bearer your-api-key"
```

**Response:**
```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "completed",
  "submitted_at": "2025-11-03T12:00:00Z",
  "started_at": "2025-11-03T12:00:05Z",
  "completed_at": "2025-11-03T12:05:30Z",
  "result": {
    "pr_url": "https://github.com/user/repo/pull/123",
    "branch_name": "u/codebot/abc1234/add-dark-mode",
    "work_dir": "/path/to/workspace"
  }
}
```

### List Completed Tasks

```bash
curl "http://localhost:5000/api/tasks?status=completed&limit=10" \
  -H "Authorization: Bearer your-api-key"
```

### Python Integration

```python
import requests
import time

API_URL = "http://localhost:5000/api"
API_KEY = "your-api-key"
HEADERS = {"Authorization": f"Bearer {API_KEY}"}

# Submit task
response = requests.post(
    f"{API_URL}/tasks/submit",
    headers=HEADERS,
    json={
        "repository_url": "https://github.com/user/repo.git",
        "description": "Add feature X"
    }
)
task_id = response.json()["task_id"]
print(f"Task submitted: {task_id}")

# Poll for completion
while True:
    response = requests.get(
        f"{API_URL}/tasks/{task_id}/status",
        headers=HEADERS
    )
    data = response.json()
    
    print(f"Status: {data['status']}")
    
    if data["status"] in ["completed", "failed"]:
        break
    
    time.sleep(5)

# Print result
if data["status"] == "completed":
    print(f"PR URL: {data['result']['pr_url']}")
else:
    print(f"Error: {data.get('error', 'Unknown error')}")
```

### JavaScript/Node.js Integration

```javascript
const axios = require('axios');

const API_URL = 'http://localhost:5000/api';
const API_KEY = 'your-api-key';
const headers = { 'Authorization': `Bearer ${API_KEY}` };

async function submitTask() {
  // Submit task
  const { data } = await axios.post(
    `${API_URL}/tasks/submit`,
    {
      repository_url: 'https://github.com/user/repo.git',
      description: 'Add feature X'
    },
    { headers }
  );
  
  const taskId = data.task_id;
  console.log(`Task submitted: ${taskId}`);
  
  // Poll for completion
  while (true) {
    const { data: status } = await axios.get(
      `${API_URL}/tasks/${taskId}/status`,
      { headers }
    );
    
    console.log(`Status: ${status.status}`);
    
    if (['completed', 'failed'].includes(status.status)) {
      if (status.status === 'completed') {
        console.log(`PR URL: ${status.result.pr_url}`);
      } else {
        console.log(`Error: ${status.error}`);
      }
      break;
    }
    
    await new Promise(resolve => setTimeout(resolve, 5000));
  }
}

submitTask();
```

## Webhook Examples

### Query Response Example

**Reviewer comment:**
> What does the `particleCount` parameter do?

**Codebot response:**
> The `particleCount` parameter controls the number of confetti pieces generated in the animation. A value of 100 means 100 individual particles will be created. Higher values create a denser effect, lower values create a lighter effect.
>
> *Reply generated by codebot ü§ñ*

### Change Request Example

**Reviewer comment:**
> Please make the particle count random between 50 and 200

**Codebot response:**
> ‚úÖ Updated particle count to be random (50-200)
>
> **Changes:**
> - Modified `triggerConfetti()` to use `Math.floor(Math.random() * 151) + 50`
> - Added comment explaining the range
>
> **Results:** All 37 tests passing
>
> *Reply generated by codebot ü§ñ*

### Ambiguous Comment Example

**Reviewer comment:**
> This could be better

**Codebot response:**
> ü§î Could you clarify what you'd like me to do?
>
> Please clarify if you'd like me to:
> - **Answer a question** about the code
> - **Make specific changes** to the code
>
> *Reply generated by codebot ü§ñ*

## CI/CD Integration

### GitHub Actions

```yaml
name: Automated Task Execution

on:
  issues:
    types: [labeled]

jobs:
  execute-task:
    if: github.event.label.name == 'codebot'
    runs-on: ubuntu-latest
    
    steps:
      - name: Submit task to codebot
        run: |
          TASK_ID=$(curl -X POST ${{ secrets.CODEBOT_URL }}/api/tasks/submit \
            -H "Authorization: Bearer ${{ secrets.CODEBOT_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{
              "repository_url": "${{ github.event.repository.clone_url }}",
              "description": "${{ github.event.issue.body }}"
            }' | jq -r '.task_id')
          
          echo "Task ID: $TASK_ID"
          echo "TASK_ID=$TASK_ID" >> $GITHUB_ENV
      
      - name: Wait for completion
        run: |
          while true; do
            STATUS=$(curl -s ${{ secrets.CODEBOT_URL }}/api/tasks/$TASK_ID/status \
              -H "Authorization: Bearer ${{ secrets.CODEBOT_API_KEY }}" \
              | jq -r '.status')
            
            if [ "$STATUS" = "completed" ] || [ "$STATUS" = "failed" ]; then
              break
            fi
            
            sleep 10
          done
          
          echo "Final status: $STATUS"
```

### GitLab CI

```yaml
codebot-task:
  stage: deploy
  only:
    - tags
  script:
    - |
      TASK_ID=$(curl -X POST $CODEBOT_URL/api/tasks/submit \
        -H "Authorization: Bearer $CODEBOT_API_KEY" \
        -H "Content-Type: application/json" \
        -d "{
          \"repository_url\": \"$CI_REPOSITORY_URL\",
          \"description\": \"Deploy version $CI_COMMIT_TAG\"
        }" | jq -r '.task_id')
      
      echo "Task ID: $TASK_ID"
      
      while true; do
        STATUS=$(curl -s $CODEBOT_URL/api/tasks/$TASK_ID/status \
          -H "Authorization: Bearer $CODEBOT_API_KEY" \
          | jq -r '.status')
        
        if [ "$STATUS" = "completed" ] || [ "$STATUS" = "failed" ]; then
          break
        fi
        
        sleep 10
      done
```

## Advanced Use Cases

### Batch Task Submission

```python
import requests

API_URL = "http://localhost:5000/api"
API_KEY = "your-api-key"
HEADERS = {"Authorization": f"Bearer {API_KEY}"}

tasks = [
    {
        "repository_url": "https://github.com/user/repo1.git",
        "description": "Add feature A"
    },
    {
        "repository_url": "https://github.com/user/repo2.git",
        "description": "Fix bug B"
    },
    {
        "repository_url": "https://github.com/user/repo3.git",
        "description": "Update dependency C"
    }
]

# Submit all tasks
task_ids = []
for task in tasks:
    response = requests.post(
        f"{API_URL}/tasks/submit",
        headers=HEADERS,
        json=task
    )
    task_id = response.json()["task_id"]
    task_ids.append(task_id)
    print(f"Submitted task: {task_id}")

print(f"Total tasks submitted: {len(task_ids)}")
```

### Monitoring Dashboard

```python
import requests
import time
from collections import Counter

API_URL = "http://localhost:5000/api"
API_KEY = "your-api-key"
HEADERS = {"Authorization": f"Bearer {API_KEY}"}

def get_dashboard():
    response = requests.get(
        f"{API_URL}/tasks?limit=100",
        headers=HEADERS
    )
    tasks = response.json()["tasks"]
    
    status_counts = Counter(t["status"] for t in tasks)
    
    print("\n=== Codebot Dashboard ===")
    print(f"Total tasks: {len(tasks)}")
    print(f"Pending: {status_counts['pending']}")
    print(f"Running: {status_counts['running']}")
    print(f"Completed: {status_counts['completed']}")
    print(f"Failed: {status_counts['failed']}")
    print("=" * 25)

# Update every 30 seconds
while True:
    get_dashboard()
    time.sleep(30)
```

## Next Steps

- [CLI Usage Guide](cli-usage.md) - Learn CLI commands
- [HTTP API Guide](http-api.md) - API reference
- [Webhooks Guide](webhooks.md) - PR automation

---

[‚Üê Back to Documentation](index.md)
